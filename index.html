<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Análise de Vendas - Top-Mar Comercial</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .kpi-card {
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="w-screen overflow-x-hidden">
        <div class="min-h-screen">
            <header class="bg-white shadow-sm p-4 sticky top-0 z-10">
                <div class="max-w-7xl mx-auto flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 p-2 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800">Dashboard de Vendas</h1>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-700">Top-Mar Comercial</p>
                        <p class="text-sm text-gray-500">Análise de Performance</p>
                    </div>
                </div>
            </header>

            <main class="p-4 md:p-6 lg:p-8 max-w-7xl mx-auto">
                
                <div class="mb-6 flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label for="period-filter" class="block text-sm font-medium text-gray-700 mb-1">Período</label>
                        <select id="period-filter" class="w-full bg-white border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="30">Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="180" selected>Últimos 6 meses</option>
                            <option value="365">Último ano</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="region-filter" class="block text-sm font-medium text-gray-700 mb-1">Região</label>
                        <select id="region-filter" class="w-full bg-white border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="all">Todas as Regiões</option>
                            <option value="Sudeste">Sudeste</option>
                            <option value="Sul">Sul</option>
                            <option value="Nordeste">Nordeste</option>
                            <option value="Centro-Oeste">Centro-Oeste</option>
                            <option value="Norte">Norte</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                        <div class="bg-blue-100 p-3 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm text-gray-500 font-medium">Faturamento Total</p>
                            <p id="total-revenue" class="text-2xl lg:text-3xl font-bold text-gray-800 break-words">R$ 0</p>
                        </div>
                    </div>
                    <div class="kpi-card bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                        <div class="bg-green-100 p-3 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg></div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm text-gray-500 font-medium">Vendas Realizadas</p>
                            <p id="total-sales" class="text-2xl lg:text-3xl font-bold text-gray-800 break-words">0</p>
                        </div>
                    </div>
                    <div class="kpi-card bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                        <div class="bg-yellow-100 p-3 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#d97706" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg></div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm text-gray-500 font-medium">Ticket Médio</p>
                            <p id="average-ticket" class="text-2xl lg:text-3xl font-bold text-gray-800 break-words">R$ 0</p>
                        </div>
                    </div>
                    <div class="kpi-card bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                        <div class="bg-purple-100 p-3 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div>
                        <div class="min-w-0 flex-1">
                            <p class="text-sm text-gray-500 font-medium">Novos Clientes</p>
                            <p id="new-customers" class="text-2xl lg:text-3xl font-bold text-gray-800 break-words">0</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex-shrink-0">Evolução de Vendas</h3>
                        <div class="relative h-80 lg:h-auto flex-grow">
                            <canvas id="salesOverTimeChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex-shrink-0">Vendas por Região</h3>
                        <div class="relative h-80 lg:h-auto flex-grow">
                            <canvas id="salesByRegionChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-md flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex-shrink-0">Top Vendedores</h3>
                        <div class="relative h-80 lg:h-auto flex-grow">
                            <canvas id="topSalespeopleChart"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex-shrink-0">Vendas por Categoria de Produto</h3>
                        <div class="relative h-80 lg:h-auto flex-grow">
                            <canvas id="salesByCategoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Vendas Recentes</h3>
                    <div class="overflow-x-auto custom-scrollbar">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3">ID da Venda</th>
                                    <th scope="col" class="px-6 py-3">Data</th>
                                    <th scope="col" class="px-6 py-3">Cliente</th>
                                    <th scope="col" class="px-6 py-3">Vendedor</th>
                                    <th scope="col" class="px-6 py-3">Região</th>
                                    <th scope="col" class="px-6 py-3">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="sales-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const regions = ['Sudeste', 'Sul', 'Nordeste', 'Centro-Oeste', 'Norte'];
        const categories = ['Ferramentas', 'Materiais Básicos', 'Elétrica', 'Hidráulica', 'Acabamentos', 'Pintura'];
        const salespeople = ['Cenourinha', 'Batatinha', 'Abobrinha', 'Beterrabinha', 'Tomatinho'];
        const customers = Array.from({ length: 150 }, (_, i) => `Cliente ${1001 + i}`);

        function generateMockData(days) {
            const data = [];
            const today = new Date();
            for (let i = 0; i < days * 5; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - Math.floor(Math.random() * days));
                const value = Math.floor(Math.random() * 180) + 20;
                data.push({
                    id: `VEN-${10000 + i}`,
                    date: date.toISOString().split('T')[0],
                    customer: customers[Math.floor(Math.random() * customers.length)],
                    salesperson: salespeople[Math.floor(Math.random() * salespeople.length)],
                    region: regions[Math.floor(Math.random() * regions.length)],
                    category: categories[Math.floor(Math.random() * categories.length)],
                    value: value,
                    isNewCustomer: Math.random() > 0.8
                });
            }
            return data.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        let fullSalesData = generateMockData(365);
        let chartInstances = {};
        let currentFilteredData = [];

        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        const formatNumber = (value) => new Intl.NumberFormat('pt-BR').format(value);

        function updateDashboard() {
            const periodDays = parseInt(document.getElementById('period-filter').value);
            const selectedRegion = document.getElementById('region-filter').value;
            
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - periodDays);

            currentFilteredData = fullSalesData.filter(d => {
                const saleDate = new Date(d.date);
                const inPeriod = saleDate >= startDate;
                const inRegion = selectedRegion === 'all' || d.region === selectedRegion;
                return inPeriod && inRegion;
            });

            updateKPIs(currentFilteredData);
            updateSalesOverTimeChart(currentFilteredData);
            updateSalesByRegionChart(currentFilteredData);
            updateSalesByCategoryChart(currentFilteredData);
            updateTopSalespeopleChart(currentFilteredData);
            updateSalesTable(currentFilteredData.slice(0, 10));
        }

        function updateKPIs(data) {
            const totalRevenue = data.reduce((sum, sale) => sum + sale.value, 0);
            const totalSales = data.length;
            const averageTicket = totalSales > 0 ? totalRevenue / totalSales : 0;
            const newCustomers = data.filter(d => d.isNewCustomer).length;

            document.getElementById('total-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('total-sales').textContent = formatNumber(totalSales);
            document.getElementById('average-ticket').textContent = formatCurrency(averageTicket);
            document.getElementById('new-customers').textContent = formatNumber(newCustomers);
        }
        
        function updateSalesTable(data) {
            const tableBody = document.getElementById('sales-table-body');
            tableBody.innerHTML = '';
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">Nenhum dado encontrado para os filtros selecionados.</td></tr>`;
                return;
            }
            data.forEach(sale => {
                const row = `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${sale.id}</td>
                        <td class="px-6 py-4">${new Date(sale.date).toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4">${sale.customer}</td>
                        <td class="px-6 py-4">${sale.salesperson}</td>
                        <td class="px-6 py-4">${sale.region}</td>
                        <td class="px-6 py-4 font-semibold">${formatCurrency(sale.value)}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        const chartColors = {
            blue: 'rgba(59, 130, 246, 0.6)', green: 'rgba(34, 197, 94, 0.6)',
            yellow: 'rgba(234, 179, 8, 0.6)', purple: 'rgba(139, 92, 246, 0.6)',
            red: 'rgba(239, 68, 68, 0.6)', indigo: 'rgba(99, 102, 241, 0.6)',
            pink: 'rgba(236, 72, 153, 0.6)', teal: 'rgba(20, 184, 166, 0.6)',
        };
        
        const chartBorderColors = {
            blue: 'rgba(59, 130, 246, 1)', green: 'rgba(34, 197, 94, 1)',
            yellow: 'rgba(234, 179, 8, 1)', purple: 'rgba(139, 92, 246, 1)',
            red: 'rgba(239, 68, 68, 1)', indigo: 'rgba(99, 102, 241, 1)',
            pink: 'rgba(236, 72, 153, 1)', teal: 'rgba(20, 184, 166, 1)',
        }

        function createOrUpdateChart(chartId, chartType, data, options) {
            const ctx = document.getElementById(chartId).getContext('2d');
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
            }
            chartInstances[chartId] = new Chart(ctx, { type: chartType, data: data, options: options });
        }

        function updateSalesOverTimeChart(data) {
            const salesByDate = data.reduce((acc, sale) => {
                acc[sale.date] = (acc[sale.date] || 0) + sale.value;
                return acc;
            }, {});

            const sortedDates = Object.keys(salesByDate).sort((a,b) => new Date(a) - new Date(b));
            
            const chartData = {
                labels: sortedDates,
                datasets: [{
                    label: 'Faturamento', data: sortedDates.map(date => salesByDate[date]),
                    borderColor: chartBorderColors.blue, backgroundColor: chartColors.blue,
                    fill: true, tension: 0.3,
                }]
            };

            const periodDays = parseInt(document.getElementById('period-filter').value);
            let unit = 'day';
            if (periodDays > 90) unit = 'month';
            if (periodDays > 30 && periodDays <=90) unit = 'week';

            const options = {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { type: 'time', time: { unit: unit, tooltipFormat: 'dd/MM/yyyy' }, grid: { display: false } },
                    y: { beginAtZero: true, ticks: { callback: value => formatCurrency(value) } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatCurrency(context.raw)}` } }
                }
            };
            createOrUpdateChart('salesOverTimeChart', 'line', chartData, options);
        }

        function updateSalesByRegionChart(data) {
            const salesByRegion = data.reduce((acc, sale) => {
                acc[sale.region] = (acc[sale.region] || 0) + sale.value;
                return acc;
            }, {});

            const chartData = {
                labels: Object.keys(salesByRegion),
                datasets: [{
                    label: 'Vendas por Região', data: Object.values(salesByRegion),
                    backgroundColor: Object.values(chartColors), borderColor: Object.values(chartBorderColors),
                    borderWidth: 1
                }]
            };
            const options = {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: { callbacks: { label: (context) => `${context.label}: ${formatCurrency(context.raw)}` } }
                }
            };
            createOrUpdateChart('salesByRegionChart', 'doughnut', chartData, options);
        }

        function updateSalesByCategoryChart(data) {
            const salesByCategory = data.reduce((acc, sale) => {
                acc[sale.category] = (acc[sale.category] || 0) + sale.value;
                return acc;
            }, {});
            
            const chartData = {
                labels: Object.keys(salesByCategory),
                datasets: [{
                    label: 'Faturamento', data: Object.values(salesByCategory),
                    backgroundColor: chartColors.green, borderColor: chartBorderColors.green,
                    borderWidth: 1
                }]
            };
            const options = {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { callback: value => formatCurrency(value) } },
                    x: { grid: { display: false } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatCurrency(context.raw)}` } }
                }
            };
            createOrUpdateChart('salesByCategoryChart', 'bar', chartData, options);
        }

        function updateTopSalespeopleChart(data) {
            const salesByPerson = data.reduce((acc, sale) => {
                acc[sale.salesperson] = (acc[sale.salesperson] || 0) + sale.value;
                return acc;
            }, {});

            const sortedSalespeople = Object.entries(salesByPerson).sort(([, a], [, b]) => b - a).slice(0, 5);

            const chartData = {
                labels: sortedSalespeople.map(entry => entry[0]),
                datasets: [{
                    label: 'Faturamento', data: sortedSalespeople.map(entry => entry[1]),
                    backgroundColor: chartColors.purple, borderColor: chartBorderColors.purple,
                    borderWidth: 1
                }]
            };
            const options = {
                indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { beginAtZero: true, ticks: { callback: value => formatCurrency(value) } },
                    y: { grid: { display: false } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${formatCurrency(context.raw)}` } }
                }
            };
            createOrUpdateChart('topSalespeopleChart', 'bar', chartData, options);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('period-filter').addEventListener('change', updateDashboard);
            document.getElementById('region-filter').addEventListener('change', updateDashboard);
            updateDashboard();
        });
    </script>
</body>
</html>
